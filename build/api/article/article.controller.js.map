{"version":3,"sources":["../../../src/api/article/article.controller.js"],"names":["getArticle","req","res","Object","keys","query","length","console","log","articles","articleService","loadArticleData","responseHandle","send","HttpStatusCode","OK","data","message","tags","dateStart","dateEnd","page","limit","key","Date","updatedAt","$gte","$lt","$in","$text","$search","totalPages","pagingHandle","paging","model","articleModel","selection","options","sendPaging","error","INTERNAL_SERVER","errors","create","article","body","like","likeArticle","id","params","updatedArticle","findOneAndUpdate","_id","published","$inc"],"mappings":"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","sourcesContent":["import articleModel from './article.model';\nimport pagingHandle from '../../utils/pagingHandle';\nimport responseHandle from '../../utils/responseHandle';\nimport articleService from './article.service';\nimport { HttpStatusCode } from '../../const/httpCode';\nconst getArticle = async (req, res) => {\n  try {\n    if (Object.keys(req.query).length === 0) {\n      console.log('here');\n      const articles = articleService.loadArticleData();\n      return responseHandle.send(res, HttpStatusCode.OK, {\n        data: articles,\n        message: 'get top 20 success',\n      });\n    }\n    let { tags, dateStart, dateEnd, page, limit, key } = req.query;\n    dateStart = new Date(dateStart);\n    dateEnd = new Date(dateEnd);\n    let query = {};\n    if (dateStart && dateEnd)\n      query = { ...query, updatedAt: { $gte: dateStart, $lt: dateEnd } };\n    if (tags)\n      query = {\n        ...query,\n        tags: {\n          $in: tags,\n        },\n      };\n    if (key)\n      query = {\n        ...query,\n        $text: {\n          $search: key,\n        },\n      };\n    const [articles, totalPages] = await pagingHandle.paging({\n      model: articleModel,\n      query,\n      selection: {},\n      page,\n      limit,\n      options: {},\n    });\n\n    return responseHandle.sendPaging(\n      res,\n      HttpStatusCode.OK,\n      {\n        message: 'get article success',\n        data: articles,\n      },\n      totalPages,\n      page\n    );\n  } catch (error) {\n    return responseHandle.send(res, HttpStatusCode.INTERNAL_SERVER, {\n      errors: [\n        {\n          error: error.message,\n        },\n      ],\n    });\n  }\n};\n\nconst create = async (req, res) => {\n  try {\n    const article = await articleModel.create({\n      ...req.body,\n      like: 0,\n    });\n    return responseHandle.send(res, HttpStatusCode.OK, {\n      message: 'create article success',\n      data: article,\n    });\n  } catch (error) {\n    return responseHandle.send(res, HttpStatusCode.INTERNAL_SERVER, {\n      errors: [\n        {\n          error: error.message,\n        },\n      ],\n    });\n  }\n};\n\nconst likeArticle = async (req, res) => {\n  try {\n    const { id } = req.params;\n    const updatedArticle = await articleModel.findOneAndUpdate(\n      {\n        _id: id,\n        published: true,\n      },\n      {\n        $inc: {\n          like: 1,\n        },\n      }\n    );\n    return responseHandle.send(res, HttpStatusCode.OK, {\n      message: 'like article success',\n      data: updatedArticle,\n    });\n  } catch (error) {\n    return responseHandle.send(res, HttpStatusCode.INTERNAL_SERVER, {\n      errors: [\n        {\n          error: error.message,\n        },\n      ],\n    });\n  }\n};\n\nexport default {\n  getArticle,\n  create,\n  likeArticle,\n};\n"],"file":"article.controller.js"}